<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shows — Nathan Finkel</title>
  <meta name="description" content="Upcoming shows, workshops, and recent highlights.">
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;1,400&family=Crimson+Text:ital@0;1&display=swap" rel="stylesheet">
</head>
<body class="page">

  <main class="page-content">
    <a href="index.html" class="back">← Back</a>
    <h1>Shows</h1>
    <p class="lede">Upcoming shows and recent highlights.</p>

    <!-- Filter -->
    <div class="filters">
      <button class="filter active" data-filter="all">All</button>
      <button class="filter" data-filter="ambient">Music</button>
      <button class="filter" data-filter="facilitation">Workshops</button>
      <button class="filter" data-filter="glia">Glia</button>
    </div>

    <!-- Upcoming -->
    <section class="events-section">
      <h2>Upcoming</h2>
      <div id="upcoming-events"></div>
      <p id="no-upcoming" class="muted" style="display: none;">No upcoming events. Check back soon!</p>
    </section>

    <!-- Past -->
    <section class="events-section">
      <h2>Past</h2>
      <div id="past-events"></div>
    </section>

  </main>

  <footer>© <span id="year"></span> Nathan Finkel</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    let allEvents = [];
    let currentFilter = 'all';

    // Load events
    fetch('assets/events.json')
      .then(r => r.json())
      .then(events => {
        allEvents = events;
        render();
      });

    // Filter buttons
    document.querySelectorAll('.filter').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        render();
      });
    });

    function render() {
      const now = new Date().toISOString().split('T')[0];
      
      const filtered = currentFilter === 'all' 
        ? allEvents 
        : allEvents.filter(e => e.tags.includes(currentFilter));

      const upcoming = filtered.filter(e => e.date >= now);
      const past = filtered.filter(e => e.date < now);

      document.getElementById('upcoming-events').innerHTML = upcoming.map(renderEvent).join('');
      document.getElementById('past-events').innerHTML = past.map(renderEvent).join('');
      
      document.getElementById('no-upcoming').style.display = upcoming.length ? 'none' : 'block';
    }

    function renderEvent(e) {
      const date = new Date(e.date).toLocaleDateString('en-GB', { 
        day: 'numeric', month: 'short', year: 'numeric' 
      });
      return `
        <div class="event-card">
          <div class="event-date">${date}</div>
          <div class="event-info">
            <strong>${e.title}</strong>
            <span class="event-venue">${e.venue}, ${e.location}</span>
            ${e.ticketUrl ? `<a href="${e.ticketUrl}" target="_blank">Tickets →</a>` : ''}
          </div>
        </div>
      `;
    }
  </script>

</body>
</html>
